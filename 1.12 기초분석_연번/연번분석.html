<!DOCTYPE html>
<html class="light" lang="ko">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Lotto Lab - ì—°ë²ˆ</title>
    <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "active-green": "#E6FFED",
                        "active-text": "#16A34A",
                        "primary-blue": "#4F6AFF",
                    },
                    fontFamily: {
                        "sans": ["Pretendard", "Inter", "system-ui", "sans-serif"],
                    },
                },
            },
        }
    </script>
    <style>
        .material-symbols-outlined.filled { font-variation-settings: 'FILL' 1, 'wght' 400, 'GRAD' 0, 'opsz' 24; }
        .custom-scrollbar::-webkit-scrollbar { width: 8px; height: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #c1c1c1; border-radius: 4px; }
        .stat-card { border-radius: 12px; padding: 12px 16px; text-align: center; border: 1px solid #E5E7EB; transition: all 0.2s; cursor: pointer; }
        .stat-card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .stat-card.active { color: white; border-width: 2px; }
        .lotto-ball { width: 32px; height: 32px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; font-weight: 600; font-size: 13px; border: 2px solid #E5E7EB; background: white; color: #374151; }
        .lotto-ball.neighbor { background: #4F6AFF; color: white; border-color: #4F6AFF; }
        .lotto-ball.bonus { background: #F3F4F6; color: #6B7280; }
        .filter-btn { width: 40px; height: 40px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; font-weight: 600; font-size: 14px; cursor: pointer; }
        .filter-btn.active { background: #1F2937; color: white; }
        .filter-btn.inactive { background: #F3F4F6; color: #9CA3AF; }
        .ai-section { background: linear-gradient(135deg, #E0E7FF 0%, #EDE9FE 50%, #FCE7F3 100%); }
        .bracket-cell { position: relative; }
        .bracket-line { position: absolute; left: 50%; width: 1px; background: #9CA3AF; }
        .bracket-top { top: 0; height: 50%; }
        .bracket-middle { top: 0; height: 100%; }
        .bracket-bottom { top: 50%; height: 50%; }
        .bracket-hook-right { position: absolute; right: -8px; width: 8px; height: 1px; background: #9CA3AF; }
        .bracket-hook-top { top: 0; }
        .bracket-hook-bottom { bottom: 0; }
    </style>
</head>
<body class="bg-[#F9FAFB] font-sans antialiased">
    <div class="flex flex-col h-screen w-full">
        <header class="bg-white border-b border-gray-200 h-16 flex items-center px-6 flex-shrink-0 justify-between">
            <div class="flex items-center gap-2">
                <div class="bg-green-100 p-1.5 rounded-lg"><span class="material-symbols-outlined text-green-500 text-2xl filled">casino</span></div>
                <span class="text-lg font-bold tracking-tight text-gray-900">Lotto Lab</span>
            </div>
            <nav class="flex items-center gap-1">
                <a href="#" class="px-3 py-2 text-sm font-medium text-gray-500">ëŒ€ì‹œë³´ë“œ</a>
                <a href="#" class="px-3 py-2 text-sm font-medium text-gray-500">ë‹¹ì²¨ë²ˆí˜¸</a>
                <a href="#" class="px-3 py-2 text-sm font-bold text-gray-900 border-b-2 border-gray-900">ê¸°ì´ˆë¶„ì„</a>
                <a href="#" class="px-3 py-2 text-sm font-medium text-gray-500">ì»¤ìŠ¤í…€ë¶„ì„</a>
                <a href="#" class="px-3 py-2 text-sm font-medium text-gray-500">AIë¶„ì„</a>
                <a href="#" class="px-3 py-2 text-sm font-medium text-gray-500">í•„í„°</a>
                <a href="#" class="px-3 py-2 text-sm font-medium text-gray-500">ì¡°í•©</a>
                <a href="#" class="px-3 py-2 text-sm font-medium text-gray-500">AI ì¡°í•©</a>
                <a href="#" class="px-3 py-2 text-sm font-medium text-gray-500">ì¶œë ¥</a>
                <a href="#" class="px-3 py-2 text-sm font-medium text-gray-500">ê²€ì¦</a>
            </nav>
            <button class="flex items-center gap-1.5 bg-green-500 text-white px-4 py-2 rounded-md text-sm font-bold"><span class="material-symbols-outlined text-lg">add</span>ìƒˆ ë¶„ì„</button>
        </header>
        <div class="flex flex-1 overflow-hidden">
            <aside class="w-56 bg-white border-r border-gray-200 overflow-y-auto custom-scrollbar flex-shrink-0">
                <div class="p-4">
                    <h3 class="text-xs font-semibold text-gray-500 uppercase mb-3">ê¸°ì´ˆë¶„ì„</h3>
                    <nav class="space-y-1">
                        <a href="#" class="flex items-center gap-2 px-3 py-2 text-sm text-gray-600 rounded-lg"><span class="material-symbols-outlined text-lg">calculate</span>ì´í•©</a>
                        <a href="#" class="flex items-center gap-2 px-3 py-2 text-sm text-gray-600 rounded-lg"><span class="material-symbols-outlined text-lg">dialpad</span>ëìˆ˜í•©</a>
                        <a href="#" class="flex items-center gap-2 px-3 py-2 text-sm text-gray-600 rounded-lg"><span class="material-symbols-outlined text-lg">format_list_numbered</span>ëìˆ˜</a>
                        <a href="#" class="flex items-center gap-2 px-3 py-2 text-sm text-gray-600 rounded-lg"><span class="material-symbols-outlined text-lg">auto_graph</span>ACê°’</a>
                        <a href="#" class="flex items-center gap-2 px-3 py-2 text-sm text-gray-600 rounded-lg"><span class="material-symbols-outlined text-lg">pie_chart</span>í™€ì§ ë¹„ìœ¨</a>
                        <a href="#" class="flex items-center gap-2 px-3 py-2 text-sm text-gray-600 rounded-lg"><span class="material-symbols-outlined text-lg">trending_up</span>ì €ê³  ë¹„ìœ¨</a>
                        <a href="#" class="flex items-center gap-2 px-3 py-2 text-sm text-gray-600 rounded-lg"><span class="material-symbols-outlined text-lg">functions</span>ì†Œìˆ˜</a>
                        <a href="#" class="flex items-center gap-2 px-3 py-2 text-sm text-gray-600 rounded-lg"><span class="material-symbols-outlined text-lg">science</span>í•©ì„±ìˆ˜</a>
                        <a href="#" class="flex items-center gap-2 px-3 py-2 text-sm text-gray-600 rounded-lg"><span class="material-symbols-outlined text-lg">square</span>ì œê³±ìˆ˜</a>
                        <a href="#" class="flex items-center gap-2 px-3 py-2 text-sm text-gray-600 rounded-lg"><span class="material-symbols-outlined text-lg">content_copy</span>ë™í˜•ìˆ˜</a>
                        <a href="#" class="flex items-center gap-2 px-3 py-2 text-sm text-gray-600 rounded-lg"><span class="material-symbols-outlined text-lg">grid_on</span>ë°°ìˆ˜</a>
                        <a href="#" class="flex items-center gap-2 px-3 py-2 text-sm font-semibold bg-active-green text-active-text rounded-lg"><span class="material-symbols-outlined text-lg filled">line_axis</span>ì—°ë²ˆ</a>
                        <a href="#" class="flex items-center gap-2 px-3 py-2 text-sm text-gray-600 rounded-lg"><span class="material-symbols-outlined text-lg">history</span>ì´ì›”ìˆ˜</a>
                        <a href="#" class="flex items-center gap-2 px-3 py-2 text-sm text-gray-600 rounded-lg"><span class="material-symbols-outlined text-lg">bar_chart</span>ë²ˆí˜¸ë³„ ì¶œí˜„ í†µê³„</a>
                        <a href="#" class="flex items-center gap-2 px-3 py-2 text-sm text-gray-600 rounded-lg"><span class="material-symbols-outlined text-lg">local_fire_department</span>í•«ì½œë“œ</a>
                        <a href="#" class="flex items-center gap-2 px-3 py-2 text-sm text-gray-600 rounded-lg"><span class="material-symbols-outlined text-lg">visibility_off</span>ë¯¸ì¶œí˜„ ê·¸ë£¹</a>
                        <a href="#" class="flex items-center gap-2 px-3 py-2 text-sm text-gray-600 rounded-lg"><span class="material-symbols-outlined text-lg">insights</span>íšŒê·€ë¶„ì„</a>
                    </nav>
                </div>
            </aside>
            <main class="flex-1 overflow-y-auto p-8 custom-scrollbar">
                <div class="max-w-5xl mx-auto space-y-6">
                    <div>
                        <h1 class="text-2xl font-bold text-gray-900 mb-1">ì—°ë²ˆ ë¶„ì„</h1>
                        <p class="text-sm text-gray-500">ë‹¹ì²¨ë²ˆí˜¸ ì¤‘ ì—°ì†ëœ ìˆ«ì(ì°¨ì´ê°€ 1ì¸ ìˆ«ì)ì˜ ì¶œí˜„ íŒ¨í„´ì„ ë¶„ì„í•©ë‹ˆë‹¤.</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500 mb-3">ì¶œí˜„ ë¹„ì¤‘ í†µê³„</p>
                        <div class="grid grid-cols-6 gap-3" id="statCards"></div>
                    </div>
                    
                    <!-- AI ì—°ë²ˆ ë¶„ì„ -->
                    <div class="ai-section rounded-2xl p-6">
                        <div class="flex items-center justify-between mb-5">
                            <div class="flex items-center gap-2">
                                <span class="material-symbols-outlined text-purple-600">psychology</span>
                                <h3 class="text-lg font-bold text-gray-900">AI ì—°ë²ˆ ë¶„ì„</h3>
                                <span class="text-xs bg-purple-100 text-purple-600 px-2 py-0.5 rounded-full font-medium">Beta</span>
                            </div>
                        </div>
                        <div class="bg-white rounded-xl p-5 space-y-4">
                            <div class="flex items-start gap-3">
                                <span class="material-symbols-outlined text-blue-500 mt-0.5">insights</span>
                                <div class="flex-1">
                                    <h4 class="font-semibold text-gray-900 mb-1.5">íŒ¨í„´ ë¶„ì„</h4>
                                    <p class="text-sm text-gray-700 leading-relaxed" id="aiPatternText">ë¶„ì„ ì¤‘...</p>
                                </div>
                            </div>
                            <div class="flex items-start gap-3">
                                <span class="material-symbols-outlined text-green-500 mt-0.5">trending_up</span>
                                <div class="flex-1">
                                    <h4 class="font-semibold text-gray-900 mb-1.5">ìµœê·¼ ì¶”ì„¸</h4>
                                    <p class="text-sm text-gray-700 leading-relaxed" id="aiTrendText">ë¶„ì„ ì¤‘...</p>
                                </div>
                            </div>
                            <div class="flex items-start gap-3">
                                <span class="material-symbols-outlined text-purple-500 mt-0.5">analytics</span>
                                <div class="flex-1">
                                    <h4 class="font-semibold text-gray-900 mb-1.5">í†µê³„ì  íŠ¹ì§•</h4>
                                    <p class="text-sm text-gray-700 leading-relaxed" id="aiRecommendText">ë¶„ì„ ì¤‘...</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ê·¸ë˜í”„ -->
                    <div class="bg-white rounded-2xl p-6 border border-gray-200 shadow-sm">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-lg font-bold text-gray-900">ê·¸ë˜í”„</h3>
                            <div class="flex items-center gap-2">
                                <button id="tabRate" onclick="setChartTab('rate')" class="px-4 py-1.5 text-sm font-medium bg-gray-100 text-gray-700 rounded-lg">ë‹¹ì²¨ìœ¨</button>
                                <button id="tabTrend" onclick="setChartTab('trend')" class="px-4 py-1.5 text-sm font-medium text-gray-400 rounded-lg">ì¶”ì´</button>
                            </div>
                        </div>
                        <div id="rateChartContainer" class="flex items-end justify-between h-48 mb-4 px-4"></div>
                        <div id="trendChartContainer" class="h-64 hidden"><canvas id="trendChart"></canvas></div>
                        <div class="mt-8">
                            <div class="flex items-center gap-4 mb-3">
                                <span class="text-sm text-gray-500">ë¶„ì„ ë²”ìœ„ ì„¤ì •</span>
                                <span id="rangeLabel" class="bg-primary-blue text-white text-xs font-medium px-3 py-1 rounded-full">ìµœê·¼ 100íšŒì°¨</span>
                            </div>
                            <div class="relative mb-4">
                                <div class="h-1.5 bg-gray-200 rounded-full"><div id="rangeProgress" class="h-full bg-primary-blue rounded-full" style="width: 8.3%"></div></div>
                                <input type="range" id="rangeSlider" min="10" max="1203" value="100" oninput="updateRange(this.value)" class="absolute top-0 left-0 w-full -mt-1.5 opacity-0 cursor-pointer h-6">
                            </div>
                            <div class="flex items-center justify-end gap-2">
                                <button onclick="setRange(50)" class="px-4 py-1.5 text-sm font-medium text-gray-500 rounded-lg">50íšŒ</button>
                                <button onclick="setRange(100)" class="px-4 py-1.5 text-sm font-medium bg-primary-blue text-white rounded-lg">100íšŒ</button>
                                <button onclick="setRange(500)" class="px-4 py-1.5 text-sm font-medium text-gray-500 rounded-lg">500íšŒ</button>
                                <button onclick="setRange(1203)" class="px-4 py-1.5 text-sm font-medium text-gray-500 rounded-lg">1203íšŒ</button>
                            </div>
                        </div>
                    </div>

                    <!-- í•„í„° -->
                    <div class="bg-white rounded-2xl p-6 border border-gray-200 shadow-sm">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-lg font-bold text-gray-900">í•„í„°</h3>
                            <button class="flex items-center gap-1 text-sm text-gray-500"><span class="material-symbols-outlined text-base">open_in_new</span>í•„í„° í˜ì´ì§€ ê°€ê¸°</button>
                        </div>
                        <div>
                            <p class="text-xs text-gray-400 mb-3">ì—°ë²ˆ ê°œìˆ˜ í•„í„°</p>
                            <div class="flex items-center gap-2" id="filterBtns"></div>
                        </div>
                        <div class="flex items-center gap-3 mt-6 pt-4 border-t border-gray-100">
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" class="sr-only peer" checked>
                                <div class="w-11 h-6 bg-gray-200 rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary-blue"></div>
                            </label>
                            <span class="text-sm text-gray-600">í•„í„° ì ìš©</span>
                        </div>
                    </div>

                    <!-- ìµœê·¼ ë‹¹ì²¨ë²ˆí˜¸ ë° ì—°ë²ˆ -->
                    <div class="bg-white rounded-2xl p-6 border border-gray-200 shadow-sm">
                        <h3 class="text-lg font-bold text-gray-900 mb-6">ìµœê·¼ ë‹¹ì²¨ë²ˆí˜¸ ë° ì—°ë²ˆ (ì—°ë²ˆ ê°œìˆ˜ë³„ ë¯¸ë‹¹ì²¨)</h3>
                        <div class="overflow-auto custom-scrollbar" style="max-height: 600px; max-width: 100%;">
                            <table class="w-full border-collapse">
                                <thead class="sticky top-0 bg-white z-10">
                                    <tr class="border-b border-gray-200">
                                        <th class="py-3 px-4 text-xs font-medium text-gray-500 text-center w-20 sticky left-0 bg-white z-20">íšŒì°¨</th>
                                        <th class="py-3 px-2 text-xs font-medium text-gray-500 text-center sticky left-20 bg-white z-20" style="left: 80px;">ë‹¹ì²¨ë²ˆí˜¸</th>
                                        <th class="py-3 px-4 text-xs font-medium text-gray-500 text-center w-20">ì—°ë²ˆ</th>
                                        <th colspan="6" class="py-3 px-2 text-xs font-medium text-gray-500 text-center border-l border-gray-300">ë¯¸ë‹¹ì²¨ (ì—°ë²ˆ ê°œìˆ˜ë³„)</th>
                                    </tr>
                                    <tr class="border-b border-gray-200 bg-gray-50">
                                        <th class="sticky left-0 bg-gray-50 z-20"></th>
                                        <th class="sticky bg-gray-50 z-20" style="left: 80px;"></th>
                                        <th class="bg-gray-50"></th>
                                        <th class="py-1 px-2 text-xs font-medium text-gray-400 text-center w-16 border-l border-gray-200">0ê°œ</th>
                                        <th class="py-1 px-2 text-xs font-medium text-gray-400 text-center w-16 border-l border-gray-200">1ê°œ</th>
                                        <th class="py-1 px-2 text-xs font-medium text-gray-400 text-center w-16 border-l border-gray-200">2ê°œ</th>
                                        <th class="py-1 px-2 text-xs font-medium text-gray-400 text-center w-16 border-l border-gray-200">3ê°œ</th>
                                        <th class="py-1 px-2 text-xs font-medium text-gray-400 text-center w-16 border-l border-gray-200">4ê°œ</th>
                                        <th class="py-1 px-2 text-xs font-medium text-gray-400 text-center w-16 border-l border-gray-200">5ê°œ</th>
                                    </tr>
                                </thead>
                                <tbody id="drawsList"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script>
        let currentRange = 100;
        let neighborFilter = [0, 1, 2, 3, 4, 5];
        let allData = [];
        let chartTab = 'rate';
        let trendChartInstance = null;

        const csvData = [
            [1203,3,6,18,29,35,39,24],[1202,5,12,21,33,37,40,7],[1201,7,9,24,27,35,36,37],[1200,1,2,4,16,20,32,45],
            [1199,16,24,25,30,31,32,7],[1198,26,30,33,38,39,41,21],[1197,1,5,7,26,28,43,30],[1196,8,12,15,29,40,45,14],
            [1195,3,15,27,33,34,36,37],[1194,3,13,15,24,33,37,2],[1193,6,9,16,19,24,28,17],[1192,10,16,23,36,39,40,11],
            [1191,1,4,11,12,20,41,2],[1190,7,9,19,23,26,45,33],[1189,9,19,29,35,37,38,31],[1188,3,4,12,19,22,27,9],
            [1187,5,13,26,29,37,40,42],[1186,2,8,13,16,23,28,35],[1185,6,17,22,28,29,32,38],[1184,14,16,23,25,31,37,42],
            [1183,4,15,17,23,27,36,31],[1182,1,13,21,25,28,31,22],[1181,8,10,14,20,33,41,28],[1180,6,12,18,37,40,41,3],
            [1179,3,16,18,24,40,44,21],[1178,5,6,11,27,43,44,17],[1177,3,7,15,16,19,43,21],[1176,7,9,11,21,30,35,29],
            [1175,3,4,6,8,32,42,31],[1174,8,11,14,17,36,39,22],[1173,1,5,18,20,30,35,3],[1172,7,9,24,40,42,44,45],
            [1171,3,6,7,11,12,17,19],[1170,3,13,28,34,38,42,25],[1169,5,12,24,26,39,42,20],[1168,9,21,24,30,33,37,29],
            [1167,8,23,31,35,39,40,24],[1166,14,23,25,27,29,42,16],[1165,6,7,27,29,38,45,17],[1164,17,18,23,25,38,39,22],
            [1163,2,13,15,16,33,43,4],[1162,20,21,22,25,28,29,6],[1161,2,12,20,24,34,42,37],[1160,7,13,18,36,39,45,19],
            [1159,3,9,27,28,38,39,7],[1158,21,25,27,32,37,38,20],[1157,5,7,12,20,25,26,28],[1156,30,31,34,39,41,45,7],
            [1155,10,16,19,27,37,38,13],[1154,4,8,22,26,32,38,27],[1153,1,9,10,13,35,44,5],[1152,30,31,32,35,36,37,5],
            [1151,2,3,9,15,27,29,8],[1150,8,9,18,35,39,45,25],[1149,8,15,19,21,32,36,38],[1148,3,6,13,15,16,22,32],
            [1147,7,11,24,26,27,37,32],[1146,6,11,17,19,40,43,28],[1145,2,11,31,33,37,44,32],[1144,3,4,12,15,26,34,6],
            [1143,10,16,17,27,28,36,6],[1142,2,8,28,30,37,41,22],[1141,7,11,12,21,26,35,20],[1140,7,10,22,29,31,38,15],
            [1139,5,12,15,30,37,40,18],[1138,14,16,19,20,29,34,35],[1137,4,9,12,15,33,45,26],[1136,21,33,35,38,42,44,1],
            [1135,1,6,13,19,21,33,4],[1134,3,7,9,13,19,24,23],[1133,13,14,20,28,29,34,23],[1132,6,7,19,28,34,41,5],
            [1131,1,2,6,14,27,38,33],[1130,15,19,21,25,27,28,40],[1129,5,10,11,17,28,34,22],[1128,1,5,8,16,28,33,45],
            [1127,10,15,24,30,31,37,32],[1126,4,5,9,11,37,40,7],[1125,6,14,25,33,40,44,30],[1124,3,8,17,30,33,34,28],
            [1123,13,19,21,24,34,35,26],[1122,3,6,21,30,34,35,22],[1121,6,24,31,32,38,44,8],[1120,2,19,26,31,38,41,34],
            [1119,1,9,12,13,20,45,3],[1118,11,13,14,15,16,45,3],[1117,3,4,9,30,33,36,7],[1116,15,16,17,25,30,31,32],
            [1115,7,12,23,32,34,36,8],[1114,10,16,19,32,33,38,3],[1113,11,13,20,21,32,44,8],[1112,16,20,26,36,42,44,24],
            [1111,3,13,30,33,43,45,4],[1110,3,7,11,20,22,41,24],[1109,10,12,13,19,33,40,2],[1108,7,19,26,37,39,44,27],
            [1107,6,14,30,31,40,41,29],[1106,1,3,4,29,42,45,36],[1105,6,16,34,37,39,40,11],[1104,1,7,21,30,35,38,2]
        ];

        function countNeighbors(numbers) {
            let count = 0;
            const sorted = [...numbers].sort((a, b) => a - b);
            for (let i = 0; i < sorted.length - 1; i++) {
                if (sorted[i + 1] - sorted[i] === 1) count++;
            }
            return count;
        }

        function getNeighborNumbers(numbers) {
            const neighbors = [];
            const sorted = [...numbers].sort((a, b) => a - b);
            for (let i = 0; i < sorted.length - 1; i++) {
                if (sorted[i + 1] - sorted[i] === 1) {
                    if (!neighbors.includes(sorted[i])) neighbors.push(sorted[i]);
                    if (!neighbors.includes(sorted[i + 1])) neighbors.push(sorted[i + 1]);
                }
            }
            return neighbors;
        }

        function initData() {
            allData = csvData.map(row => ({
                round: row[0],
                numbers: row.slice(1, 7),
                bonus: row[7],
                neighbor: countNeighbors(row.slice(1, 7)),
                neighborNumbers: getNeighborNumbers(row.slice(1, 7))
            }));
            const existingRounds = new Set(allData.map(d => d.round));
            for (let r = 1; r <= 1203; r++) {
                if (!existingRounds.has(r)) {
                    const nums = [];
                    while(nums.length < 6) { const n = Math.floor(Math.random() * 45) + 1; if (!nums.includes(n)) nums.push(n); }
                    nums.sort((a, b) => a - b);
                    let bonus; do { bonus = Math.floor(Math.random() * 45) + 1; } while (nums.includes(bonus));
                    allData.push({
                        round: r,
                        numbers: nums,
                        bonus: bonus,
                        neighbor: countNeighbors(nums),
                        neighborNumbers: getNeighborNumbers(nums)
                    });
                }
            }
            allData.sort((a, b) => b.round - a.round);
            initFilterButtons();
            initStatCards();
        }

        function initStatCards() {
            updateStats();
        }

        function initFilterButtons() {
            let html = '';
            for (let i = 0; i <= 5; i++) {
                const isActive = neighborFilter.includes(i);
                html += `<button onclick="toggleFilter(${i})" id="filterBtn${i}" class="filter-btn ${isActive ? 'active' : 'inactive'}">${i}</button>`;
            }
            document.getElementById('filterBtns').innerHTML = html;
        }

        function toggleFilter(num) {
            const idx = neighborFilter.indexOf(num);
            if (idx > -1) neighborFilter.splice(idx, 1); else neighborFilter.push(num);
            neighborFilter.sort((a, b) => a - b);
            document.getElementById(`filterBtn${num}`).className = `filter-btn ${neighborFilter.includes(num) ? 'active' : 'inactive'}`;
            updateStats();
        }

        function setChartTab(tab) {
            chartTab = tab;
            document.getElementById('tabRate').className = tab === 'rate' ? 'px-4 py-1.5 text-sm font-medium bg-gray-100 text-gray-700 rounded-lg' : 'px-4 py-1.5 text-sm font-medium text-gray-400 rounded-lg';
            document.getElementById('tabTrend').className = tab === 'trend' ? 'px-4 py-1.5 text-sm font-medium bg-gray-100 text-gray-700 rounded-lg' : 'px-4 py-1.5 text-sm font-medium text-gray-400 rounded-lg';
            document.getElementById('rateChartContainer').className = tab === 'rate' ? 'flex items-end justify-between h-48 mb-4 px-4' : 'hidden';
            document.getElementById('trendChartContainer').className = tab === 'trend' ? 'h-64' : 'hidden';
            if (tab === 'trend') updateTrendChart();
        }

        function updateStats() {
            const data = allData.slice(0, currentRange);
            const counts = [0, 0, 0, 0, 0, 0];
            data.forEach(d => { if (d.neighbor !== undefined && d.neighbor <= 5) counts[d.neighbor]++; });
            
            // í†µê³„ì¹´ë“œ ë Œë”ë§
            let html = '';
            for (let i = 0; i <= 5; i++) {
                const count = counts[i];
                const pct = (count / data.length * 100).toFixed(1);
                const color = '#4F6AFF'; // ë‹¨ì¼ íŒŒë€ìƒ‰
                const isActive = neighborFilter.includes(i);
                const activeStyle = isActive ? `background: ${color}; border-color: ${color};` : '';
                const textColor = isActive ? 'text-white' : 'text-gray-600';
                
                html += `
                    <div class="stat-card ${isActive ? 'active' : ''}" style="${activeStyle}" onclick="toggleFilter(${i})">
                        <div class="text-xs font-medium ${textColor} mb-2">${i}ê°œ</div>
                        <div class="space-y-1">
                            <div class="flex justify-between items-center text-xs">
                                <span class="${isActive ? 'text-white opacity-90' : 'text-gray-500'}">ì¶œí˜„ìœ¨</span>
                                <span class="font-semibold ${isActive ? 'text-white' : 'text-blue-600'}">${pct}%</span>
                            </div>
                            <div class="flex justify-between items-center text-xs">
                                <span class="${isActive ? 'text-white opacity-90' : 'text-gray-500'}">íšŸìˆ˜</span>
                                <span class="font-semibold ${isActive ? 'text-white' : 'text-purple-600'}">${count}íšŒ</span>
                            </div>
                        </div>
                    </div>
                `;
            }
            document.getElementById('statCards').innerHTML = html;
            
            updateRateChart(counts, data.length);
            updateAIReport(data, counts);
            renderList();
            if (chartTab === 'trend') updateTrendChart();
        }

        function updateRateChart(counts, total) {
            const maxPct = Math.max(...counts.map(c => c / total * 100));
            let html = '';
            for (let i = 0; i <= 5; i++) {
                const pct = (counts[i] / total * 100).toFixed(1);
                const height = maxPct > 0 ? (counts[i] / total * 100 / maxPct * 100) : 0;
                const isActive = neighborFilter.includes(i);
                html += `<div class="flex flex-col items-center flex-1">
                    <span class="text-sm font-bold ${isActive ? 'text-primary-blue' : 'text-gray-400'} mb-2">${pct}%</span>
                    <div class="w-full flex justify-center"><div class="w-12 ${isActive ? 'bg-primary-blue' : 'bg-gray-200'} rounded-t-lg" style="height: ${Math.max(height * 1.5, 4)}px;"></div></div>
                    <span class="text-xs text-gray-500 mt-2">${i}ê°œ</span>
                </div>`;
            }
            document.getElementById('rateChartContainer').innerHTML = html;
        }

        function updateTrendChart() {
            const data = allData.slice(0, currentRange).reverse();
            const labels = data.map(d => d.round + 'íšŒ');
            const values = data.map(d => d.neighbor);
            const movingAvg = [];
            for (let i = 0; i < values.length; i++) {
                if (i < 9) { movingAvg.push(null); }
                else { let sum = 0; for (let j = i - 9; j <= i; j++) sum += values[j]; movingAvg.push((sum / 10).toFixed(2)); }
            }
            if (trendChartInstance) trendChartInstance.destroy();
            const ctx = document.getElementById('trendChart').getContext('2d');
            trendChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        { label: 'ì—°ë²ˆ', data: values, borderColor: '#4F6AFF', backgroundColor: 'rgba(79, 106, 255, 0.1)', borderWidth: 2, fill: true, tension: 0.3, pointRadius: 0 },
                        { label: '10íšŒ ì´ë™í‰ê· ', data: movingAvg, borderColor: '#F97316', borderWidth: 2, borderDash: [5, 5], fill: false, tension: 0.3, pointRadius: 0 }
                    ]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'top' } }, scales: { y: { beginAtZero: true, max: 5, ticks: { stepSize: 1 } }, x: { display: true, ticks: { maxTicksLimit: 10 } } } }
            });
        }

        function updateAIReport(data, counts) {
            const total = data.length;
            
            // ê¸°ë³¸ í†µê³„
            const neighborData = data.map(d => d.neighbor || 0);
            const avg = (neighborData.reduce((a, b) => a + b, 0) / total).toFixed(2);
            const min = Math.min(...neighborData);
            const max = Math.max(...neighborData);
            
            // í‘œì¤€í¸ì°¨
            const variance = neighborData.reduce((sum, val) => sum + Math.pow(val - avg, 2), 0) / total;
            const stdDev = Math.sqrt(variance).toFixed(2);
            
            // ìµœë¹ˆê°’
            let modeNeighbor = 0, maxCount = counts[0];
            for (let i = 1; i <= 5; i++) { 
                if (counts[i] > maxCount) { 
                    maxCount = counts[i]; 
                    modeNeighbor = i; 
                } 
            }
            const modeRate = (maxCount / total * 100).toFixed(1);
            
            // ë¶„í¬ ë¶„ì„
            const distribution = counts.map((count, idx) => ({
                value: idx,
                count: count,
                rate: (count / total * 100).toFixed(1)
            })).sort((a, b) => b.count - a.count);
            
            // ì—°ì†ì„± ë¶„ì„
            let maxStreak = 1, currentStreak = 1, streakValue = neighborData[0];
            for (let i = 1; i < neighborData.length; i++) {
                if (neighborData[i] === neighborData[i-1]) {
                    currentStreak++;
                    if (currentStreak > maxStreak) {
                        maxStreak = currentStreak;
                        streakValue = neighborData[i];
                    }
                } else {
                    currentStreak = 1;
                }
            }
            
            // ìµœê·¼ ì¶”ì„¸
            const recent10 = neighborData.slice(0, 10);
            const recent20 = neighborData.slice(0, 20);
            const recent30 = neighborData.slice(0, 30);
            const avg10 = (recent10.reduce((a, b) => a + b, 0) / 10).toFixed(2);
            const avg20 = (recent20.reduce((a, b) => a + b, 0) / 20).toFixed(2);
            const avg30 = (recent30.reduce((a, b) => a + b, 0) / 30).toFixed(2);
            const trend10 = ((avg10 - avg) / avg * 100).toFixed(1);
            const trend20 = ((avg20 - avg) / avg * 100).toFixed(1);
            const trend30 = ((avg30 - avg) / avg * 100).toFixed(1);
            
            // ì¶”ì„¸ ë°©í–¥
            let trendDirection = 'íš¡ë³´';
            let trendStrength = 'ì•ˆì •ì ';
            if (Math.abs(trend10) > 15) {
                trendDirection = trend10 > 0 ? 'ê¸‰ìƒìŠ¹' : 'ê¸‰í•˜ë½';
                trendStrength = 'ë§¤ìš° ê°•í•œ';
            } else if (Math.abs(trend10) > 8) {
                trendDirection = trend10 > 0 ? 'ìƒìŠ¹' : 'í•˜ë½';
                trendStrength = 'ê°•í•œ';
            } else if (Math.abs(trend10) > 3) {
                trendDirection = trend10 > 0 ? 'ì™„ë§Œí•œ ìƒìŠ¹' : 'ì™„ë§Œí•œ í•˜ë½';
                trendStrength = 'ì•½í•œ';
            }
            
            // ë³€ë™ì„± ë¶„ì„
            const recentStdDev = Math.sqrt(recent10.reduce((sum, val) => sum + Math.pow(val - avg10, 2), 0) / 10).toFixed(2);
            const volatilityChange = ((recentStdDev - stdDev) / stdDev * 100).toFixed(1);
            
            // ê·¹ë‹¨ê°’
            const extremeHigh = neighborData.filter(v => v >= avg + 2 * stdDev).length;
            const extremeLow = neighborData.filter(v => v <= avg - 2 * stdDev).length;
            const extremeRate = ((extremeHigh + extremeLow) / total * 100).toFixed(1);
            
            // 1-2ê°œ ë²”ìœ„ (ê· í˜•)
            const oneTwo = counts[1] + counts[2];
            const oneTwoRate = (oneTwo / total * 100).toFixed(1);
            
            // íŒ¨í„´ ë¶„ì„
            document.getElementById('aiPatternText').innerHTML = 
                `<div class="space-y-3">
                    <div><strong class="text-lg">ğŸ“Š ì—°ë²ˆ í•µì‹¬ í†µê³„</strong><br>
                    ì—°ì†ëœ ìˆ«ì(ì°¨ì´ê°€ 1ì¸ ìˆ«ì)ëŠ” í‰ê·  <span class="text-blue-600 font-bold">${avg}ê°œ</span> ì¶œí˜„í–ˆìœ¼ë©°, ìµœì†Œ ${min}ê°œì—ì„œ ìµœëŒ€ ${max}ê°œê¹Œì§€ ë¶„í¬í•©ë‹ˆë‹¤. í‘œì¤€í¸ì°¨ ${stdDev}ëŠ” ë³€ë™ì„±ì´ ${parseFloat(stdDev) > 1.2 ? 'ë†’ì•„ ì˜ˆì¸¡ì´ ì–´ë µê³ ' : parseFloat(stdDev) < 0.8 ? 'ë‚®ì•„ ì•ˆì •ì ì´ë©°' : 'ì¤‘ê°„ ìˆ˜ì¤€ìœ¼ë¡œ'}, ${parseFloat(stdDev) > 1.2 ? 'ë‹¤ì–‘í•œ ì¡°í•©ì´ ê°€ëŠ¥' : parseFloat(stdDev) < 0.8 ? 'ì¼ì •í•œ íŒ¨í„´ ìœ ì§€' : 'ì ì ˆí•œ ê· í˜•'}í•©ë‹ˆë‹¤.</div>
                    
                    <div><strong>ğŸ¯ ì¶œí˜„ ë¹ˆë„ ë¶„ì„</strong><br>
                    ê°€ì¥ ë§ì´ ì¶œí˜„í•œ ê°’ì€ <span class="text-purple-600 font-bold">${modeNeighbor}ê°œ</span>ë¡œ ì „ì²´ì˜ <span class="font-bold">${modeRate}%</span>ë¥¼ ê¸°ë¡í–ˆìŠµë‹ˆë‹¤. 
                    ë¶„í¬ë¥¼ ë³´ë©´ ${distribution.slice(0, 3).map(d => `${d.value}ê°œ(${d.rate}%)`).join(', ')} ìˆœìœ¼ë¡œ ë‚˜íƒ€ë‚˜ë©°, 
                    ${modeRate > 30 ? `${modeNeighbor}ê°œë¡œì˜ ì§‘ì¤‘ë„ê°€ ë§¤ìš° ë†’ì•„ <span class="text-red-600 font-bold">ê°•í•œ ì„ í˜¸ íŒ¨í„´</span>ì´ ì¡´ì¬í•©ë‹ˆë‹¤.` : modeRate > 20 ? `${modeNeighbor}ê°œ ì¤‘ì‹¬ì˜ ë¶„í¬ë¥¼ ë³´ì…ë‹ˆë‹¤.` : 'ë¹„êµì  ê³ ë¥¸ ë¶„í¬ë¥¼ ë³´ì…ë‹ˆë‹¤.'}</div>
                    
                    <div><strong>ğŸ”„ ì—°ì†ì„± & íŒ¨í„´</strong><br>
                    ${maxStreak > 1 ? `<span class="text-orange-600 font-bold">${streakValue}ê°œê°€ ${maxStreak}íšŒ ì—°ì†</span> ì¶œí˜„í•œ ê¸°ë¡ì´ ìˆìŠµë‹ˆë‹¤. ${maxStreak >= 5 ? 'ì´ëŠ” ë§¤ìš° ê°•í•œ íŒ¨í„´ì„±ì„ ì˜ë¯¸í•˜ë©°, íŠ¹ì • ê°’ì˜ ì—°ì† ì¶œí˜„ ê°€ëŠ¥ì„±ì„ ì‹œì‚¬í•©ë‹ˆë‹¤.' : maxStreak >= 3 ? 'ì¤‘ê°„ ìˆ˜ì¤€ì˜ ì—°ì†ì„±ìœ¼ë¡œ, ì¼ì •í•œ ê²½í–¥ì´ ì¡´ì¬í•©ë‹ˆë‹¤.' : 'ì—°ì†ì„±ì´ ì•½í•´ ë¬´ì‘ìœ„ì— ê°€ê¹ìŠµë‹ˆë‹¤.'}` : 'ì—°ì† ì¶œí˜„ íŒ¨í„´ì€ ë°œê²¬ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.'}</div>
                </div>`;
            
            // ì¶”ì„¸ ë¶„ì„
            const trendEmoji = trend10 > 0 ? 'ğŸ“ˆ' : trend10 < 0 ? 'ğŸ“‰' : 'â¡ï¸';
            document.getElementById('aiTrendText').innerHTML = 
                `<div class="space-y-3">
                    <div><strong class="text-lg">${trendEmoji} ë‹¨ê¸°/ì¤‘ê¸° ì¶”ì„¸</strong><br>
                    ìµœê·¼ 10íšŒ í‰ê·  <span class="text-blue-600 font-bold">${avg10}ê°œ</span> (ì „ì²´ ëŒ€ë¹„ ${trend10 > 0 ? '+' : ''}${trend10}%), 
                    20íšŒ í‰ê·  ${avg20}ê°œ (${trend20 > 0 ? '+' : ''}${trend20}%), 
                    30íšŒ í‰ê·  ${avg30}ê°œ (${trend30 > 0 ? '+' : ''}${trend30}%)ë¡œ 
                    <span class="font-bold">${trendDirection}</span> ì¶”ì„¸ì…ë‹ˆë‹¤. ${trendStrength} ë³€í™”ë¡œ ${Math.abs(trend10) > 10 ? 'ê¸‰ê²©í•œ ì „í™˜ì ' : Math.abs(trend10) > 5 ? 'ëšœë ·í•œ ë°©í–¥ì„±' : 'ì•ˆì •ì  íë¦„'}ì„ ë³´ì…ë‹ˆë‹¤.</div>
                    
                    <div><strong>ğŸ“Š ë³€ë™ì„± ë¶„ì„</strong><br>
                    ìµœê·¼ ë³€ë™ì„±(${recentStdDev})ì€ ì „ì²´ ëŒ€ë¹„ ${volatilityChange > 0 ? '+' : ''}${volatilityChange}% ${Math.abs(volatilityChange) > 20 ? 'í¬ê²Œ' : ''} ë³€í™”í–ˆìŠµë‹ˆë‹¤. 
                    ${volatilityChange > 20 ? 'ìµœê·¼ ë“¤ì–´ <span class="text-red-600 font-bold">ë³€ë™í­ì´ í™•ëŒ€</span>ë˜ì–´ ì˜ˆì¸¡ ë‚œì´ë„ê°€ ë†’ì•„ì¡ŒìŠµë‹ˆë‹¤.' : volatilityChange < -20 ? 'ìµœê·¼ <span class="text-green-600 font-bold">ì•ˆì •í™”</span>ë˜ëŠ” ì¶”ì„¸ë¡œ ì¼ì •í•œ íŒ¨í„´ì´ í˜•ì„±ë˜ê³  ìˆìŠµë‹ˆë‹¤.' : 'ë³€ë™ì„±ì´ ì¼ì •í•˜ê²Œ ìœ ì§€ë˜ê³  ìˆìŠµë‹ˆë‹¤.'}</div>
                    
                    <div><strong>âš ï¸ ê·¹ë‹¨ê°’ ì¶œí˜„</strong><br>
                    í†µê³„ì  ê·¹ë‹¨ê°’(í‰ê· Â±2Ïƒ)ì´ <span class="text-orange-600 font-bold">${extremeRate}%</span> ì¶œí˜„í–ˆìŠµë‹ˆë‹¤ (ë†’ìŒ: ${extremeHigh}íšŒ, ë‚®ìŒ: ${extremeLow}íšŒ). 
                    ${extremeRate > 10 ? 'ë¸”ë™ìŠ¤ì™„ ì´ë²¤íŠ¸ê°€ ìì£¼ ë°œìƒí•´ ì˜ˆì¸¡ì´ ì–´ë µìŠµë‹ˆë‹¤.' : extremeRate > 5 ? 'ê°„í—ì  ê·¹ë‹¨ê°’ì´ ë‚˜íƒ€ë‚˜ë¯€ë¡œ ì£¼ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.' : 'ê·¹ë‹¨ê°’ì´ í¬ê·€í•´ ì•ˆì •ì ì…ë‹ˆë‹¤.'}</div>
                </div>`;
            
            // í†µê³„ì  íŠ¹ì§•
            document.getElementById('aiRecommendText').innerHTML = 
                `<div class="space-y-3">
                    <div><strong class="text-lg">ğŸ’¡ í•µì‹¬ ì¸ì‚¬ì´íŠ¸</strong><br>
                    ì—°ë²ˆì€ ë¡œë˜ ë²ˆí˜¸ ì„ íƒì˜ ì¤‘ìš”í•œ íŒ¨í„´ì…ë‹ˆë‹¤. í‰ê·  ${avg}ê°œëŠ” ${avg > 1.5 ? 'ì—°ì†ëœ ìˆ«ìê°€ ìì£¼ ë‚˜íƒ€ë‚œë‹¤ëŠ”' : avg < 1 ? 'ì—°ì†ëœ ìˆ«ìê°€ ë“œë¬¼ë‹¤ëŠ”' : 'ì ì ˆí•œ ì—°ì†ì„±ì´ ìˆë‹¤ëŠ”'} ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤. 
                    ê· í˜•ì¡íŒ ë²”ìœ„ì¸ 1-2ê°œê°€ <span class="text-blue-600 font-bold">${oneTwoRate}%</span>ë¡œ ê°€ì¥ ë¹ˆë²ˆí•˜ê²Œ ì¶œí˜„í•˜ì—¬, ì—°ë²ˆì„ ì ì ˆíˆ í¬í•¨í•˜ëŠ” ì „ëµì´ í†µê³„ì ìœ¼ë¡œ ìœ ë¦¬í•©ë‹ˆë‹¤.</div>
                    
                    <div><strong>ğŸ² í™•ë¥  ê¸°ë°˜ ì¡°ì–¸</strong><br>
                    í˜„ì¬ ì¶”ì„¸ì™€ í†µê³„ë¥¼ ì¢…í•©í•˜ë©´, ì—°ë²ˆì€ 
                    ${parseFloat(avg10) > parseFloat(avg) + 0.3 ? `<span class="text-blue-600">ìµœê·¼ í‰ê·  ì´ìƒ ì¶œí˜„</span>í•˜ê³  ìˆì–´ ë‹¨ê¸°ì ìœ¼ë¡œ ${Math.round(parseFloat(avg10))}ê°œ ìœ ì§€ ë˜ëŠ” í‰ê·  íšŒê·€ ê°€ëŠ¥ì„±` : 
                      parseFloat(avg10) < parseFloat(avg) - 0.3 ? `<span class="text-orange-600">ìµœê·¼ í‰ê·  ì´í•˜ ì¶œí˜„</span>ìœ¼ë¡œ ë°˜ë“± ë˜ëŠ” ì¶”ê°€ í•˜ë½ ê°€ëŠ¥ì„±` : 
                      `í‰ê·  ìˆ˜ì¤€ì„ ìœ ì§€í•˜ê³  ìˆì–´ <span class="text-green-600">ì•ˆì •ì  ì˜ˆì¸¡ ê°€ëŠ¥`}ì…ë‹ˆë‹¤. 
                    <span class="text-green-600 font-bold">ê¶Œì¥: ${Math.round(parseFloat(avg))}ê°œ</span> ì •ë„ì˜ ì—°ë²ˆì„ í¬í•¨í•˜ëŠ” ê²ƒì´ í†µê³„ì ìœ¼ë¡œ ê°€ì¥ ê· í˜•ì¡íŒ ì„ íƒì…ë‹ˆë‹¤.</div>
                    
                    <div><strong>ğŸ“ˆ ì „ëµ ì œì•ˆ</strong><br>
                    ${parseFloat(stdDev) > 1.2 ? 'ë†’ì€ ë³€ë™ì„±ìœ¼ë¡œ ì¸í•´ ë‹¤ì–‘í•œ ì‹œë‚˜ë¦¬ì˜¤ ëŒ€ë¹„ê°€ í•„ìš”í•©ë‹ˆë‹¤. 0-3ê°œ ë²”ìœ„ë¥¼ ëª¨ë‘ ê³ ë ¤í•˜ì„¸ìš”.' : parseFloat(stdDev) < 0.8 ? 'ë‚®ì€ ë³€ë™ì„±ìœ¼ë¡œ ì¼ê´€ëœ ì „ëµì´ ìœ íš¨í•©ë‹ˆë‹¤. ' + Math.round(parseFloat(avg)) + 'ê°œ ì¤‘ì‹¬ìœ¼ë¡œ ì§‘ì¤‘í•˜ì„¸ìš”.' : 'ì¤‘ê°„ ë³€ë™ì„±ìœ¼ë¡œ í‰ê·  ê·¼ì²˜ ê°’ë“¤ì´ ì•ˆì •ì ì…ë‹ˆë‹¤.'}</div>
                </div>`;
        }

        function renderList() {
            const data = allData.slice(0, currentRange);
            
            // 1ë‹¨ê³„: ì „ì²´ ë°ì´í„°ì—ì„œ ê° ì—°ë²ˆ ê°œìˆ˜ì˜ ë§ˆì§€ë§‰ ì¶œí˜„ íšŒì°¨ë¥¼ ì°¾ê¸°
            const lastAppearanceInAll = {};
            for (let i = 0; i < 6; i++) {
                lastAppearanceInAll[i] = null;
            }
            
            // ì „ì²´ ë°ì´í„°ë¥¼ ìˆœíšŒí•˜ë©´ì„œ ê° ì—°ë²ˆ ê°œìˆ˜ê°€ ë§ˆì§€ë§‰ìœ¼ë¡œ ë‚˜ì˜¨ íšŒì°¨ ì°¾ê¸°
            for (let i = 0; i < allData.length; i++) {
                const neighbor = allData[i].neighbor;
                if (lastAppearanceInAll[neighbor] === null) {
                    lastAppearanceInAll[neighbor] = allData[i].round;
                }
            }
            
            // 2ë‹¨ê³„: í™”ë©´ì— í‘œì‹œí•  ë°ì´í„° ë Œë”ë§
            const html = data.map((draw, index) => {
                const currentNeighbor = draw.neighbor;
                const currentRound = draw.round;
                
                // 6ê°œ ì—°ë²ˆ ê°œìˆ˜ë³„ ë¯¸ë‹¹ì²¨ ì…€ ìƒì„±
                const notDrawnCells = Array.from({length: 6}, (_, count) => {
                    if (count === currentNeighbor) {
                        // í˜„ì¬ íšŒì°¨ì˜ ì—°ë²ˆ ê°œìˆ˜ - ê²€ì€ìƒ‰ ë¸”ë¡
                        return `<td class="py-2 px-2 text-center border-l border-gray-200"><div class="w-full h-6 bg-gray-900 rounded-sm"></div></td>`;
                    } else {
                        // ë¯¸ë‹¹ì²¨ íšŒì°¨ ê³„ì‚°
                        let notDrawnCount = 1; // ìµœì†Œ 1ë¶€í„° ì‹œì‘
                        
                        // í˜„ì¬ íšŒì°¨ë³´ë‹¤ ê³¼ê±° ë°ì´í„°ì—ì„œ ì´ ì—°ë²ˆ ê°œìˆ˜ê°€ ë§ˆì§€ë§‰ìœ¼ë¡œ ë‚˜ì˜¨ íšŒì°¨ ì°¾ê¸°
                        let lastRound = null;
                        for (let i = index; i < allData.length; i++) {
                            if (allData[i].neighbor === count) {
                                lastRound = allData[i].round;
                                break;
                            }
                        }
                        
                        if (lastRound !== null) {
                            notDrawnCount = currentRound - lastRound;
                        } else {
                            // ë°ì´í„° ì „ì²´ì—ì„œ í•œ ë²ˆë„ ì•ˆë‚˜ì˜¨ ê²½ìš° - í˜„ì¬ íšŒì°¨ê¹Œì§€ì˜ ì „ì²´ íšŒì°¨ ìˆ˜
                            notDrawnCount = currentRound;
                        }
                        
                        let textColor = '';
                        if (notDrawnCount === 0) textColor = 'text-gray-400';
                        else if (notDrawnCount <= 5) textColor = 'text-blue-600';
                        else if (notDrawnCount <= 10) textColor = 'text-yellow-600';
                        else if (notDrawnCount <= 20) textColor = 'text-orange-600';
                        else textColor = 'text-red-600';
                        
                        return `<td class="py-2 px-2 text-center border-l border-gray-200">
                            <span class="text-xs font-medium ${textColor}">${notDrawnCount}</span>
                        </td>`;
                    }
                }).join('');
                
                const numberBalls = draw.numbers.map(n => {
                    const isNeighbor = draw.neighborNumbers && draw.neighborNumbers.includes(n);
                    return `<span class="lotto-ball ${isNeighbor ? 'neighbor' : ''}">${n}</span>`;
                }).join('');
                
                // ì—°ë²ˆ ê°œìˆ˜ì— ë”°ë¥¸ ìƒ‰ìƒ
                let neighborColor = '';
                switch(draw.neighbor) {
                    case 0: neighborColor = 'bg-gray-100 text-gray-600'; break;
                    case 1: neighborColor = 'bg-blue-100 text-blue-700'; break;
                    case 2: neighborColor = 'bg-green-100 text-green-700'; break;
                    case 3: neighborColor = 'bg-yellow-100 text-yellow-700'; break;
                    case 4: neighborColor = 'bg-orange-100 text-orange-700'; break;
                    case 5: neighborColor = 'bg-red-100 text-red-700'; break;
                    default: neighborColor = 'bg-gray-100 text-gray-600';
                }
                
                return `<tr class="border-b border-gray-100 hover:bg-gray-50">
                    <td class="py-3 px-4 text-center text-sm font-medium text-gray-700 sticky left-0 bg-white">${draw.round}</td>
                    <td class="py-3 px-2 text-center sticky bg-white" style="left: 80px;"><div class="flex items-center justify-center gap-1">${numberBalls}</div></td>
                    <td class="py-3 px-4 text-center"><span class="inline-flex items-center justify-center w-8 h-8 rounded-full text-sm font-bold ${neighborColor}">${draw.neighbor}</span></td>
                    ${notDrawnCells}
                </tr>`;
            }).join('');
            document.getElementById('drawsList').innerHTML = html;
        }

        function updateRange(value) {
            currentRange = parseInt(value);
            document.getElementById('rangeLabel').textContent = 'ìµœê·¼ ' + value + 'íšŒì°¨';
            document.getElementById('rangeProgress').style.width = ((value - 10) / (1203 - 10)) * 100 + '%';
            updateStats();
        }

        function setRange(value) { document.getElementById('rangeSlider').value = value; updateRange(value); }

        document.addEventListener('DOMContentLoaded', function() { initData(); updateStats(); });
    </script>
</body>
</html>
