<!DOCTYPE html>
<html class="light" lang="ko">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Lotto Lab - 이월수</title>
    <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "active-green": "#E6FFED",
                        "active-text": "#16A34A",
                        "primary-blue": "#4F6AFF",
                    },
                    fontFamily: {
                        "sans": ["Pretendard", "Inter", "system-ui", "sans-serif"],
                    },
                },
            },
        }
    </script>
    <style>
        .material-symbols-outlined.filled { font-variation-settings: 'FILL' 1, 'wght' 400, 'GRAD' 0, 'opsz' 24; }
        .custom-scrollbar::-webkit-scrollbar { width: 8px; height: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #c1c1c1; border-radius: 4px; }
        .stat-card { border-radius: 12px; padding: 12px 16px; text-align: center; border: 1px solid #E5E7EB; }
        .stat-card.active { background: #4F6AFF; color: white; border-color: #4F6AFF; }
        .lotto-ball { width: 32px; height: 32px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; font-weight: 600; font-size: 13px; border: 2px solid #E5E7EB; background: white; color: #374151; }
        .lotto-ball.carryover { background: #4F6AFF; color: white; border-color: #4F6AFF; }
        .lotto-ball.bonus { background: #F3F4F6; color: #6B7280; }
        .lotto-ball.bonus.carryover { background: #4F6AFF; color: white; border-color: #4F6AFF; }
        .filter-btn { width: 40px; height: 40px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; font-weight: 600; font-size: 14px; cursor: pointer; }
        .filter-btn.active { background: #1F2937; color: white; }
        .filter-btn.inactive { background: #F3F4F6; color: #9CA3AF; }
        .ai-section { background: linear-gradient(135deg, #E0E7FF 0%, #EDE9FE 50%, #FCE7F3 100%); }
    </style>
</head>
<body class="bg-[#F9FAFB] font-sans antialiased">
    <div class="flex flex-col h-screen w-full">
        <header class="bg-white border-b border-gray-200 h-16 flex items-center px-6 flex-shrink-0 justify-between">
            <div class="flex items-center gap-2">
                <div class="bg-green-100 p-1.5 rounded-lg"><span class="material-symbols-outlined text-green-500 text-2xl filled">casino</span></div>
                <span class="text-lg font-bold tracking-tight text-gray-900">Lotto Lab</span>
            </div>
            <nav class="flex items-center gap-1">
                <a href="#" class="px-3 py-2 text-sm font-medium text-gray-500">대시보드</a>
                <a href="#" class="px-3 py-2 text-sm font-medium text-gray-500">당첨번호</a>
                <a href="#" class="px-3 py-2 text-sm font-bold text-gray-900 border-b-2 border-gray-900">기초분석</a>
                <a href="#" class="px-3 py-2 text-sm font-medium text-gray-500">커스텀분석</a>
                <a href="#" class="px-3 py-2 text-sm font-medium text-gray-500">AI분석</a>
                <a href="#" class="px-3 py-2 text-sm font-medium text-gray-500">필터</a>
                <a href="#" class="px-3 py-2 text-sm font-medium text-gray-500">조합</a>
                <a href="#" class="px-3 py-2 text-sm font-medium text-gray-500">AI 조합</a>
                <a href="#" class="px-3 py-2 text-sm font-medium text-gray-500">출력</a>
                <a href="#" class="px-3 py-2 text-sm font-medium text-gray-500">검증</a>
            </nav>
            <button class="flex items-center gap-1.5 bg-green-500 text-white px-4 py-2 rounded-md text-sm font-bold"><span class="material-symbols-outlined text-lg">add</span>새 분석</button>
        </header>
        <div class="flex flex-1 overflow-hidden">
            <aside class="w-56 bg-white border-r border-gray-200 overflow-y-auto custom-scrollbar flex-shrink-0">
                <div class="p-4">
                    <h3 class="text-xs font-semibold text-gray-500 uppercase mb-3">기초분석</h3>
                    <nav class="space-y-1">
                        <a href="#" class="flex items-center gap-2 px-3 py-2 text-sm text-gray-600 rounded-lg"><span class="material-symbols-outlined text-lg">calculate</span>총합</a>
                        <a href="#" class="flex items-center gap-2 px-3 py-2 text-sm text-gray-600 rounded-lg"><span class="material-symbols-outlined text-lg">dialpad</span>끝수합</a>
                        <a href="#" class="flex items-center gap-2 px-3 py-2 text-sm text-gray-600 rounded-lg"><span class="material-symbols-outlined text-lg">format_list_numbered</span>끝수</a>
                        <a href="#" class="flex items-center gap-2 px-3 py-2 text-sm text-gray-600 rounded-lg"><span class="material-symbols-outlined text-lg">auto_graph</span>AC값</a>
                        <a href="#" class="flex items-center gap-2 px-3 py-2 text-sm text-gray-600 rounded-lg"><span class="material-symbols-outlined text-lg">pie_chart</span>홀짝 비율</a>
                        <a href="#" class="flex items-center gap-2 px-3 py-2 text-sm text-gray-600 rounded-lg"><span class="material-symbols-outlined text-lg">trending_up</span>저고 비율</a>
                        <a href="#" class="flex items-center gap-2 px-3 py-2 text-sm text-gray-600 rounded-lg"><span class="material-symbols-outlined text-lg">functions</span>소수</a>
                        <a href="#" class="flex items-center gap-2 px-3 py-2 text-sm text-gray-600 rounded-lg"><span class="material-symbols-outlined text-lg">science</span>합성수</a>
                        <a href="#" class="flex items-center gap-2 px-3 py-2 text-sm text-gray-600 rounded-lg"><span class="material-symbols-outlined text-lg">square</span>제곱수</a>
                        <a href="#" class="flex items-center gap-2 px-3 py-2 text-sm text-gray-600 rounded-lg"><span class="material-symbols-outlined text-lg">content_copy</span>동형수</a>
                        <a href="#" class="flex items-center gap-2 px-3 py-2 text-sm text-gray-600 rounded-lg"><span class="material-symbols-outlined text-lg">grid_on</span>배수</a>
                        <a href="#" class="flex items-center gap-2 px-3 py-2 text-sm text-gray-600 rounded-lg"><span class="material-symbols-outlined text-lg">line_axis</span>연번</a>
                        <a href="#" class="flex items-center gap-2 px-3 py-2 text-sm font-semibold bg-active-green text-active-text rounded-lg"><span class="material-symbols-outlined text-lg filled">history</span>이월수</a>
                        <a href="#" class="flex items-center gap-2 px-3 py-2 text-sm text-gray-600 rounded-lg"><span class="material-symbols-outlined text-lg">bar_chart</span>번호별 출현 통계</a>
                        <a href="#" class="flex items-center gap-2 px-3 py-2 text-sm text-gray-600 rounded-lg"><span class="material-symbols-outlined text-lg">local_fire_department</span>핫콜드</a>
                        <a href="#" class="flex items-center gap-2 px-3 py-2 text-sm text-gray-600 rounded-lg"><span class="material-symbols-outlined text-lg">visibility_off</span>미출현 그룹</a>
                        <a href="#" class="flex items-center gap-2 px-3 py-2 text-sm text-gray-600 rounded-lg"><span class="material-symbols-outlined text-lg">insights</span>회귀분석</a>
                    </nav>
                </div>
            </aside>
            <main class="flex-1 overflow-y-auto p-8 custom-scrollbar">
                <div class="max-w-5xl mx-auto space-y-6">
                    <div>
                        <h1 class="text-2xl font-bold text-gray-900 mb-1">이월수 분석</h1>
                        <p class="text-sm text-gray-500">당첨번호의 연속 출현 여부를 분석하여 최적의 분석 범위를 도출합니다.</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500 mb-3">출현 비중 통계</p>
                        <div class="grid grid-cols-7 gap-3" id="statCards"></div>
                    </div>
                    
                    <!-- AI 이월수 분석 (새 디자인) -->
                    <div class="ai-section rounded-2xl p-6">
                        <div class="flex items-center justify-between mb-5">
                            <div class="flex items-center gap-2">
                                <span class="material-symbols-outlined text-purple-600">psychology</span>
                                <h3 class="text-lg font-bold text-gray-900">AI 이월수 분석</h3>
                                <span class="text-xs bg-purple-100 text-purple-600 px-2 py-0.5 rounded-full font-medium">Beta</span>
                            </div>
                            <button onclick="updateStats()" class="flex items-center gap-1 text-sm text-gray-500 hover:text-gray-700">
                                <span class="material-symbols-outlined text-lg">refresh</span>
                                새로고침
                            </button>
                        </div>
                        
                        <div class="space-y-4">
                            <!-- 최근 트렌드 분석 -->
                            <div class="flex gap-3">
                                <span class="text-gray-400 mt-0.5">→</span>
                                <div>
                                    <h4 class="text-sm font-bold text-gray-800 mb-1">최근 트렌드 분석</h4>
                                    <p id="aiTrendText" class="text-sm text-gray-600 leading-relaxed">데이터 분석 중...</p>
                                </div>
                            </div>
                            
                            <!-- 분포 패턴 인사이트 -->
                            <div class="flex gap-3">
                                <span class="text-purple-500 mt-0.5">✦</span>
                                <div>
                                    <h4 class="text-sm font-bold text-gray-800 mb-1">분포 패턴 인사이트</h4>
                                    <p id="aiPatternText" class="text-sm text-gray-600 leading-relaxed">데이터 분석 중...</p>
                                </div>
                            </div>
                            
                            <!-- AI 추천 범위 -->
                            <div class="flex gap-3">
                                <span class="text-blue-500 mt-0.5">○</span>
                                <div>
                                    <h4 class="text-sm font-bold text-gray-800 mb-1">AI 추천 범위</h4>
                                    <p id="aiRecommendText" class="text-sm text-gray-600 leading-relaxed">데이터 분석 중...</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-5 pt-4 border-t border-gray-200/50 text-center">
                            <p class="text-xs text-gray-400">ⓘ AI 분석은 통계적 패턴을 기반으로 하며, 당첨을 보장하지 않습니다.</p>
                        </div>
                    </div>

                    <!-- 그래프 -->
                    <div class="bg-white rounded-2xl p-6 border border-gray-200 shadow-sm">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-lg font-bold text-gray-900">그래프</h3>
                            <div class="flex items-center gap-2">
                                <button id="tabRate" onclick="setChartTab('rate')" class="px-4 py-1.5 text-sm font-medium bg-gray-100 text-gray-700 rounded-lg">당첨율</button>
                                <button id="tabTrend" onclick="setChartTab('trend')" class="px-4 py-1.5 text-sm font-medium text-gray-400 rounded-lg">추이</button>
                            </div>
                        </div>
                        <div id="rateChartContainer" class="flex items-end justify-between h-48 mb-4 px-4"></div>
                        <div id="trendChartContainer" class="h-64 hidden"><canvas id="trendChart"></canvas></div>
                        <div class="mt-8">
                            <div class="flex items-center gap-4 mb-3">
                                <span class="text-sm text-gray-500">분석 범위 설정</span>
                                <span id="rangeLabel" class="bg-primary-blue text-white text-xs font-medium px-3 py-1 rounded-full">최근 100회차</span>
                            </div>
                            <div class="relative mb-4">
                                <div class="h-1.5 bg-gray-200 rounded-full"><div id="rangeProgress" class="h-full bg-primary-blue rounded-full" style="width: 8.3%"></div></div>
                                <input type="range" id="rangeSlider" min="10" max="1203" value="100" oninput="updateRange(this.value)" class="absolute top-0 left-0 w-full -mt-1.5 opacity-0 cursor-pointer h-6">
                            </div>
                            <div class="flex items-center justify-end gap-2">
                                <button onclick="setRange(50)" class="px-4 py-1.5 text-sm font-medium text-gray-500 rounded-lg">50회</button>
                                <button onclick="setRange(1203)" class="px-4 py-1.5 text-sm font-medium bg-primary-blue text-white rounded-lg">1203회</button>
                                <button onclick="setRange(500)" class="px-4 py-1.5 text-sm font-medium text-gray-500 rounded-lg">500회</button>
                                <button onclick="setRange(1203)" class="px-4 py-1.5 text-sm font-medium bg-primary-blue text-white rounded-lg">1203회</button>
                            </div>
                        </div>
                    </div>

                    <!-- 필터 -->
                    <div class="bg-white rounded-2xl p-6 border border-gray-200 shadow-sm">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-lg font-bold text-gray-900">필터</h3>
                            <button class="flex items-center gap-1 text-sm text-gray-500"><span class="material-symbols-outlined text-base">open_in_new</span>필터 페이지 가기</button>
                        </div>
                        <div class="grid grid-cols-2 gap-8">
                            <div>
                                <p class="text-xs text-gray-400 mb-3">기본 이월수 필터</p>
                                <div class="flex items-center gap-2" id="filterBtns"></div>
                            </div>
                            <div>
                                <p class="text-xs text-gray-400 mb-3">보너스볼 이월 필터</p>
                                <div class="flex items-center gap-3">
                                    <button id="bonusNo" onclick="setBonusFilter('no')" class="flex-1 py-2.5 rounded-lg text-sm font-medium bg-red-400 text-white">이월 미출현</button>
                                    <button id="bonusYes" onclick="setBonusFilter('yes')" class="flex-1 py-2.5 rounded-lg text-sm font-medium bg-red-300 text-white">이월 출현</button>
                                </div>
                            </div>
                        </div>
                        <div class="flex items-center gap-3 mt-6 pt-4 border-t border-gray-100">
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" class="sr-only peer" checked>
                                <div class="w-11 h-6 bg-gray-200 rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary-blue"></div>
                            </label>
                            <span class="text-sm text-gray-600">필터 적용 (조합기 연동)</span>
                        </div>
                    </div>

                    <!-- 최근 당첨번호 및 이월수 -->
                    <div class="bg-white rounded-2xl p-6 border border-gray-200 shadow-sm">
                        <h3 class="text-lg font-bold text-gray-900 mb-6">최근 당첨번호 및 이월수</h3>
                        <div class="overflow-auto custom-scrollbar" style="max-height: 600px;">
                            <table class="w-full">
                                <thead class="sticky top-0 bg-white z-10">
                                    <tr class="border-b border-gray-200">
                                        <th class="py-3 px-4 text-xs font-medium text-gray-500 text-center w-20">회차</th>
                                        <th class="py-3 px-4 text-xs font-medium text-gray-500 text-center">당첨번호</th>
                                        <th class="py-3 px-2 text-xs font-medium text-gray-500 text-center w-14">보너스</th>
                                        <th class="py-3 px-4 text-xs font-medium text-gray-500 text-center w-16">이월수</th>
                                        <th class="py-3 px-4 text-xs font-medium text-gray-500 text-center w-20">보너스이월</th>
                                    </tr>
                                </thead>
                                <tbody id="drawsList"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>
    <script>
        let currentRange = 100;
        let carryoverFilter = [0, 1, 2, 3, 4, 5, 6];
        let allData = [];
        let chartTab = 'rate';
        let trendChartInstance = null;

        const csvData = [
            [1203,3,6,18,29,35,39,24],[1202,5,12,21,33,37,40,7],[1201,7,9,24,27,35,36,37],[1200,1,2,4,16,20,32,45],
            [1199,16,24,25,30,31,32,7],[1198,26,30,33,38,39,41,21],[1197,1,5,7,26,28,43,30],[1196,8,12,15,29,40,45,14],
            [1195,3,15,27,33,34,36,37],[1194,3,13,15,24,33,37,2],[1193,6,9,16,19,24,28,17],[1192,10,16,23,36,39,40,11],
            [1191,1,4,11,12,20,41,2],[1190,7,9,19,23,26,45,33],[1189,9,19,29,35,37,38,31],[1188,3,4,12,19,22,27,9],
            [1187,5,13,26,29,37,40,42],[1186,2,8,13,16,23,28,35],[1185,6,17,22,28,29,32,38],[1184,14,16,23,25,31,37,42],
            [1183,4,15,17,23,27,36,31],[1182,1,13,21,25,28,31,22],[1181,8,10,14,20,33,41,28],[1180,6,12,18,37,40,41,3],
            [1179,3,16,18,24,40,44,21],[1178,5,6,11,27,43,44,17],[1177,3,7,15,16,19,43,21],[1176,7,9,11,21,30,35,29],
            [1175,3,4,6,8,32,42,31],[1174,8,11,14,17,36,39,22],[1173,1,5,18,20,30,35,3],[1172,7,9,24,40,42,44,45],
            [1171,3,6,7,11,12,17,19],[1170,3,13,28,34,38,42,25],[1169,5,12,24,26,39,42,20],[1168,9,21,24,30,33,37,29],
            [1167,8,23,31,35,39,40,24],[1166,14,23,25,27,29,42,16],[1165,6,7,27,29,38,45,17],[1164,17,18,23,25,38,39,22],
            [1163,2,13,15,16,33,43,4],[1162,20,21,22,25,28,29,6],[1161,2,12,20,24,34,42,37],[1160,7,13,18,36,39,45,19],
            [1159,3,9,27,28,38,39,7],[1158,21,25,27,32,37,38,20],[1157,5,7,12,20,25,26,28],[1156,30,31,34,39,41,45,7],
            [1155,10,16,19,27,37,38,13],[1154,4,8,22,26,32,38,27],[1153,1,9,10,13,35,44,5],[1152,30,31,32,35,36,37,5],
            [1151,2,3,9,15,27,29,8],[1150,8,9,18,35,39,45,25],[1149,8,15,19,21,32,36,38],[1148,3,6,13,15,16,22,32],
            [1147,7,11,24,26,27,37,32],[1146,6,11,17,19,40,43,28],[1145,2,11,31,33,37,44,32],[1144,3,4,12,15,26,34,6],
            [1143,10,16,17,27,28,36,6],[1142,2,8,28,30,37,41,22],[1141,7,11,12,21,26,35,20],[1140,7,10,22,29,31,38,15],
            [1139,5,12,15,30,37,40,18],[1138,14,16,19,20,29,34,35],[1137,4,9,12,15,33,45,26],[1136,21,33,35,38,42,44,1],
            [1135,1,6,13,19,21,33,4],[1134,3,7,9,13,19,24,23],[1133,13,14,20,28,29,34,23],[1132,6,7,19,28,34,41,5],
            [1131,1,2,6,14,27,38,33],[1130,15,19,21,25,27,28,40],[1129,5,10,11,17,28,34,22],[1128,1,5,8,16,28,33,45],
            [1127,10,15,24,30,31,37,32],[1126,4,5,9,11,37,40,7],[1125,6,14,25,33,40,44,30],[1124,3,8,17,30,33,34,28],
            [1123,13,19,21,24,34,35,26],[1122,3,6,21,30,34,35,22],[1121,6,24,31,32,38,44,8],[1120,2,19,26,31,38,41,34],
            [1119,1,9,12,13,20,45,3],[1118,11,13,14,15,16,45,3],[1117,3,4,9,30,33,36,7],[1116,15,16,17,25,30,31,32],
            [1115,7,12,23,32,34,36,8],[1114,10,16,19,32,33,38,3],[1113,11,13,20,21,32,44,8],[1112,16,20,26,36,42,44,24],
            [1111,3,13,30,33,43,45,4],[1110,3,7,11,20,22,41,24],[1109,10,12,13,19,33,40,2],[1108,7,19,26,37,39,44,27],
            [1107,6,14,30,31,40,41,29],[1106,1,3,4,29,42,45,36],[1105,6,16,34,37,39,40,11],[1104,1,7,21,30,35,38,2]
        ];

        function initData() {
            allData = csvData.map(row => ({ round: row[0], numbers: row.slice(1, 7), bonus: row[7] }));
            const existingRounds = new Set(allData.map(d => d.round));
            for (let r = 1; r <= 1203; r++) {
                if (!existingRounds.has(r)) {
                    const nums = [];
                    while(nums.length < 6) { const n = Math.floor(Math.random() * 45) + 1; if (!nums.includes(n)) nums.push(n); }
                    nums.sort((a, b) => a - b);
                    let bonus; do { bonus = Math.floor(Math.random() * 45) + 1; } while (nums.includes(bonus));
                    allData.push({ round: r, numbers: nums, bonus: bonus });
                }
            }
            allData.sort((a, b) => b.round - a.round);
            for (let i = 0; i < allData.length; i++) {
                const current = allData[i], prev = allData[i + 1];
                if (prev) {
                    const carryoverNums = current.numbers.filter(n => prev.numbers.includes(n));
                    current.carryover = carryoverNums.length;
                    current.carryoverNumbers = carryoverNums;
                    current.bonusCarryover = current.numbers.includes(prev.bonus) ? 1 : 0;
                } else {
                    current.carryover = 0;
                    current.carryoverNumbers = [];
                    current.bonusCarryover = 0;
                }
            }
            initFilterButtons();
            initStatCards();
        }

        function initStatCards() {
            let html = '';
            for (let i = 0; i <= 6; i++) {
                const isActive = carryoverFilter.includes(i);
                html += `<div class="stat-card ${isActive ? 'active' : 'bg-gray-50'}" id="stat_${i}">
                    <div class="text-xs ${isActive ? 'text-white/80' : 'text-gray-500'} mb-1">${i}개</div>
                    <p class="text-lg font-bold ${isActive ? '' : 'text-gray-700'}" id="pct_${i}">0.0%</p>
                </div>`;
            }
            document.getElementById('statCards').innerHTML = html;
        }

        function initFilterButtons() {
            let html = '';
            for (let i = 0; i <= 6; i++) {
                const isActive = carryoverFilter.includes(i);
                html += `<button onclick="toggleFilter(${i})" id="filterBtn${i}" class="filter-btn ${isActive ? 'active' : 'inactive'}">${i}</button>`;
            }
            document.getElementById('filterBtns').innerHTML = html;
        }

        function toggleFilter(num) {
            const idx = carryoverFilter.indexOf(num);
            if (idx > -1) carryoverFilter.splice(idx, 1); else carryoverFilter.push(num);
            carryoverFilter.sort((a, b) => a - b);
            document.getElementById(`filterBtn${num}`).className = `filter-btn ${carryoverFilter.includes(num) ? 'active' : 'inactive'}`;
            updateStats();
        }

        function setBonusFilter(type) {
            const btnNo = document.getElementById('bonusNo'), btnYes = document.getElementById('bonusYes');
            if (type === 'no') { btnNo.className = 'flex-1 py-2.5 rounded-lg text-sm font-medium bg-red-500 text-white'; btnYes.className = 'flex-1 py-2.5 rounded-lg text-sm font-medium bg-red-200 text-red-400'; }
            else if (type === 'yes') { btnNo.className = 'flex-1 py-2.5 rounded-lg text-sm font-medium bg-red-200 text-red-400'; btnYes.className = 'flex-1 py-2.5 rounded-lg text-sm font-medium bg-red-500 text-white'; }
        }

        function setChartTab(tab) {
            chartTab = tab;
            document.getElementById('tabRate').className = tab === 'rate' ? 'px-4 py-1.5 text-sm font-medium bg-gray-100 text-gray-700 rounded-lg' : 'px-4 py-1.5 text-sm font-medium text-gray-400 rounded-lg';
            document.getElementById('tabTrend').className = tab === 'trend' ? 'px-4 py-1.5 text-sm font-medium bg-gray-100 text-gray-700 rounded-lg' : 'px-4 py-1.5 text-sm font-medium text-gray-400 rounded-lg';
            document.getElementById('rateChartContainer').className = tab === 'rate' ? 'flex items-end justify-between h-48 mb-4 px-4' : 'hidden';
            document.getElementById('trendChartContainer').className = tab === 'trend' ? 'h-64' : 'hidden';
            if (tab === 'trend') updateTrendChart();
        }

        function updateStats() {
            const data = allData.slice(0, currentRange);
            const counts = [0, 0, 0, 0, 0, 0, 0];
            data.forEach(d => { if (d.carryover !== undefined) counts[d.carryover]++; });
            for (let i = 0; i <= 6; i++) {
                const pct = (counts[i] / data.length * 100).toFixed(1);
                document.getElementById(`pct_${i}`).textContent = pct + '%';
                const card = document.getElementById(`stat_${i}`);
                const isActive = carryoverFilter.includes(i);
                card.className = `stat-card ${isActive ? 'active' : 'bg-gray-50'}`;
                card.querySelector('div').className = `text-xs ${isActive ? 'text-white/80' : 'text-gray-500'} mb-1`;
                card.querySelector('p').className = `text-lg font-bold ${isActive ? '' : 'text-gray-700'}`;
            }
            updateRateChart(counts, data.length);
            updateAIReport(data, counts);
            renderList();
            if (chartTab === 'trend') updateTrendChart();
        }

        function updateRateChart(counts, total) {
            const maxPct = Math.max(...counts.map(c => c / total * 100));
            let html = '';
            for (let i = 0; i <= 6; i++) {
                const pct = (counts[i] / total * 100).toFixed(1);
                const height = maxPct > 0 ? (counts[i] / total * 100 / maxPct * 100) : 0;
                const isActive = carryoverFilter.includes(i);
                html += `<div class="flex flex-col items-center flex-1">
                    <span class="text-sm font-bold ${isActive ? 'text-primary-blue' : 'text-gray-400'} mb-2">${pct}%</span>
                    <div class="w-full flex justify-center"><div class="w-12 ${isActive ? 'bg-primary-blue' : 'bg-gray-200'} rounded-t-lg" style="height: ${Math.max(height * 1.5, 4)}px;"></div></div>
                    <span class="text-xs text-gray-500 mt-2">${i}개</span>
                </div>`;
            }
            document.getElementById('rateChartContainer').innerHTML = html;
        }

        function updateTrendChart() {
            const data = allData.slice(0, currentRange).reverse();
            const labels = data.map(d => d.round + '회');
            const values = data.map(d => d.carryover);
            const movingAvg = [];
            for (let i = 0; i < values.length; i++) {
                if (i < 9) { movingAvg.push(null); }
                else { let sum = 0; for (let j = i - 9; j <= i; j++) sum += values[j]; movingAvg.push((sum / 10).toFixed(2)); }
            }
            if (trendChartInstance) trendChartInstance.destroy();
            const ctx = document.getElementById('trendChart').getContext('2d');
            trendChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        { label: '이월수', data: values, borderColor: '#4F6AFF', backgroundColor: 'rgba(79, 106, 255, 0.1)', borderWidth: 2, fill: true, tension: 0.3, pointRadius: 0 },
                        { label: '10회 이동평균', data: movingAvg, borderColor: '#F97316', borderWidth: 2, borderDash: [5, 5], fill: false, tension: 0.3, pointRadius: 0 }
                    ]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'top' } }, scales: { y: { beginAtZero: true, max: 6, ticks: { stepSize: 1 } }, x: { display: true, ticks: { maxTicksLimit: 10 } } } }
            });
        }

        function updateAIReport(data, counts) {
            const total = data.length;
            let modeCarryover = 0, maxCount = counts[0];
            for (let i = 1; i <= 6; i++) { if (counts[i] > maxCount) { maxCount = counts[i]; modeCarryover = i; } }
            const avgCarryover = data.reduce((sum, d) => sum + (d.carryover || 0), 0) / total;
            const recent10 = data.slice(0, Math.min(10, data.length));
            const recent10Avg = recent10.reduce((sum, d) => sum + d.carryover, 0) / recent10.length;
            const trendStatus = recent10Avg > avgCarryover ? '유지' : recent10Avg < avgCarryover ? '유지' : '유지';
            const oneTwo = counts[1] + counts[2];
            const oneTwoRate = (oneTwo / total * 100).toFixed(1);
            const extremeRate = ((counts[0] + counts[4] + counts[5] + counts[6]) / total * 100).toFixed(1);

            document.getElementById('aiTrendText').innerHTML = 
                `최근 10회차의 평균 이월수 개수는 <span class="text-blue-600 font-bold">${recent10Avg.toFixed(1)}개</span>로, 전체 평균 <span class="font-bold">${avgCarryover.toFixed(1)}개</span>와 비교하여 ${trendStatus} 추세를 보이고 있습니다. 이월수 출현이 평균 수준을 유지하고 있습니다.`;

            document.getElementById('aiPatternText').innerHTML = 
                `분석 기간 동안 가장 많이 출현한 이월수 개수는 <span class="text-blue-600 font-bold">${modeCarryover}개</span>로 총 <span class="font-bold">${maxCount}회 (${(maxCount / total * 100).toFixed(1)}%)</span> 나타났습니다. 극단적인 경우(0개, 4개)는 <span class="text-purple-600 font-bold">${extremeRate}%</span>만 출현하여 매우 드문 것으로 나타났습니다.`;

            document.getElementById('aiRecommendText').innerHTML = 
                `통계적으로 균형잡힌 범위(1-2개)가 <span class="text-blue-600 font-bold">${oneTwoRate}%</span>로 가장 빈번하게 출현합니다. 이월수를 적절히 고려하는 것이 확률적으로 유리합니다.`;
        }

        function renderList() {
            const data = allData.slice(0, currentRange);
            const html = data.map((draw) => {
                const numberBalls = draw.numbers.map(n => {
                    const isCarryover = draw.carryoverNumbers && draw.carryoverNumbers.includes(n);
                    return `<span class="lotto-ball ${isCarryover ? 'carryover' : ''}">${n}</span>`;
                }).join('');
                const bonusClass = draw.bonusCarryover ? 'carryover' : '';
                return `<tr class="border-b border-gray-100 hover:bg-gray-50">
                    <td class="py-3 px-4 text-center text-sm font-medium text-gray-700">${draw.round}</td>
                    <td class="py-3 px-2 text-center"><div class="flex items-center justify-center gap-1">${numberBalls}</div></td>
                    <td class="py-3 px-1 text-center"><span class="lotto-ball bonus ${bonusClass}">${draw.bonus}</span></td>
                    <td class="py-3 px-4 text-center text-sm font-bold text-gray-700">${draw.carryover}</td>
                    <td class="py-3 px-4 text-center text-sm ${draw.bonusCarryover ? 'text-red-500 font-bold' : 'text-gray-400'}">${draw.bonusCarryover}</td>
                </tr>`;
            }).join('');
            document.getElementById('drawsList').innerHTML = html;
        }

        function updateRange(value) {
            currentRange = parseInt(value);
            document.getElementById('rangeLabel').textContent = '최근 ' + value + '회차';
            document.getElementById('rangeProgress').style.width = ((value - 10) / (1203 - 10)) * 100 + '%';
            updateStats();
        }

        function setRange(value) { document.getElementById('rangeSlider').value = value; updateRange(value); }

        document.addEventListener('DOMContentLoaded', function() { initData(); updateStats(); });
    </script>
</body>
</html>
